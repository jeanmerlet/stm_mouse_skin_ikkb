from py2cytoscape import cyrest
import numpy as np

mcl_path = "/Users/6j9/projects/mouse/irf-mcl/mcl_clusters/mouseUPenn_iRF-LOOP_normalized_0.04_mcl_clusters_1.30.txt"

cy = cyrest.cyclient()
suids = cy.network.list()['networks']

names = []
def suids_to_names(suids):
  for suid in suids:
    name = f"SUID:{suid}"
    names.append({suid: cy.network.get_attribute('name', network=name)[0]['name']})

suids_to_names(suids)
for name in names:
  print(name)

barcode_sets = []
with open(mcl_path, 'rt') as in_file:
  for line in in_file:
    barcode_sets.append(line.strip('\n').replace('\t', ','))

barcode_sets = np.asarray(barcode_sets)

# 1.20
#cluster_order = np.asarray([1, 48, 44, 31, 51, 2, 59, 40, 25, 11, 9, 5, 13, 62, 14, 55, 67, 6, 32, 43, 8, 65, 58, 16, 52, 61, 66, 24, 4, 71, 26, 69, 64, 72, 38, 0, 46, 45, 7, 56, 41, 10, 27, 53, 68, 19, 42, 20, 3, 34, 29, 36, 39, 17, 63, 60, 12, 33, 54, 49, 35, 30, 28, 73, 70, 23, 50, 15, 18, 37, 57, 21, 47, 22])

# 1.25
#cluster_order = np.asarray([1, 57, 24, 129, 8, 80, 118, 3, 44, 26, 53, 116, 128, 102, 147, 9, 52, 56, 97, 85, 81, 67, 101, 51, 152, 157, 98, 77, 40, 108, 121, 69, 2, 45, 72, 64, 115, 122, 143, 153, 156, 6, 16, 61, 27, 34, 7, 114, 136, 120, 133, 37, 22, 21, 25, 161, 79, 84, 119, 146, 162, 10, 138, 50, 36, 130, 62, 127, 82, 159, 43, 158, 105, 123, 163, 151, 155, 169, 4, 66, 112, 11, 106, 92, 23, 90, 75, 135, 17, 125, 28, 104, 33, 59, 148, 68, 29, 13, 74, 99, 18, 41, 109, 55, 49, 165, 89, 149, 124, 141, 20, 110, 160, 42, 76, 113, 47, 166, 5, 65, 15, 63, 93, 86, 107, 96, 32, 144, 38, 117, 19, 103, 150, 48, 73, 142, 87, 71, 111, 154, 131, 168, 12, 134, 60, 145, 30, 70, 88, 100, 0, 54, 139, 164, 132, 167, 140, 35, 46, 58, 137, 94, 91, 31, 78, 126, 14, 39, 95, 83])

# 1.30
cluster_order = np.asarray([3, 46, 130, 149, 33, 19, 14, 168, 201, 96, 112, 144, 93, 134, 7, 64, 202, 58, 6, 49, 273, 167, 231, 148, 78, 65, 69, 224, 138, 192, 66, 113, 88, 184, 116, 105, 275, 228, 118, 24, 75, 133, 63, 289, 110, 295, 283, 256, 177, 82, 181, 206, 54, 267, 157, 128, 125, 124, 300, 222, 199, 55, 285, 216, 218, 238, 129, 243, 271, 234, 176, 97, 263, 296, 213, 284, 262, 0, 37, 100, 111, 38, 104, 165, 162, 119, 50, 151, 81, 230, 48, 219, 22, 44, 59, 137, 198, 242, 253, 259, 108, 195, 183, 185, 182, 187, 43, 244, 276, 229, 290, 269, 89, 95, 215, 245, 135, 41, 307, 197, 281, 305, 312, 205, 315, 1, 53, 158, 140, 30, 12, 166, 90, 212, 136, 211, 175, 266, 159, 156, 179, 254, 226, 80, 87, 32, 250, 10, 223, 85, 91, 141, 258, 303, 313, 4, 71, 143, 73, 15, 67, 257, 186, 194, 36, 255, 160, 40, 200, 150, 107, 251, 292, 29, 274, 139, 270, 221, 45, 260, 286, 280, 13, 16, 103, 83, 34, 117, 17, 227, 18, 239, 92, 261, 235, 265, 35, 23, 102, 60, 70, 77, 51, 171, 191, 237, 2, 25, 5, 11, 57, 99, 236, 56, 39, 217, 288, 297, 299, 298, 304, 180, 309, 308, 240, 207, 21, 155, 42, 120, 302, 277, 170, 154, 249, 121, 169, 28, 268, 62, 47, 74, 214, 145, 76, 190, 293, 233, 278, 310, 247, 306, 204, 8, 61, 174, 115, 142, 79, 86, 203, 210, 272, 287, 220, 173, 9, 132, 196, 72, 282, 31, 109, 248, 127, 172, 178, 26, 114, 209, 106, 279, 163, 189, 311, 264, 84, 147, 161, 294, 208, 153, 126, 246, 241, 20, 52, 131, 225, 98, 301, 188, 68, 146, 232, 94, 152, 164, 27, 122, 193, 291, 252, 101, 314, 123])

barcode_sets = barcode_sets[cluster_order]

cy.network.set_current('cutoff-0.04_inf-1.30_all.txt')
for j, barcode_set in enumerate(barcode_sets):
  print(j)
  cy.layout.force_directed_cl(nodeList=barcode_set)
